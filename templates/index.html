<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movie Recommendations</title>

  <script src="https://cdn.tailwindcss.com/3.4.17"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">

</head>

<body class="h-full font-body">
  <div id="app" class="h-full w-full overflow-auto">
   <!-- HOME PAGE -->
   <div id="home-page" class="min-h-full w-full relative overflow-hidden" style="background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);">
    <div class="grain"></div>
    <!-- Decorative Elements -->
    <div class="absolute top-10 left-10 w-64 h-64 bg-red-500/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-10 right-10 w-96 h-96 bg-amber-500/10 rounded-full blur-3xl"></div>
    <!-- Floating Movie Posters -->
    <div class="absolute top-20 left-8 md:left-16 animate-float opacity-60">
     <div class="movie-poster w-20 md:w-28 h-28 md:h-40 rounded-lg shadow-2xl overflow-hidden" style="background: linear-gradient(145deg, #ef4444, #b91c1c);">
      <div class="h-full flex flex-col items-center justify-center text-white/90 p-2">
       <svg class="w-8 h-8 mb-1" fill="currentColor" viewbox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z" />
       </svg><span class="text-xs font-semibold text-center">Action</span>
      </div>
     </div>
    </div>
    <div class="absolute top-32 right-8 md:right-20 animate-float-delay opacity-60">
     <div class="movie-poster w-24 md:w-32 h-32 md:h-44 rounded-lg shadow-2xl overflow-hidden" style="background: linear-gradient(145deg, #f59e0b, #d97706);">
      <div class="h-full flex flex-col items-center justify-center text-white/90 p-2">
       <svg class="w-10 h-10 mb-1" fill="currentColor" viewbox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" />
       </svg><span class="text-xs font-semibold text-center">Musical</span>
      </div>
     </div>
    </div>
    <div class="absolute bottom-32 left-12 md:left-24 animate-float opacity-50 hidden md:block">
     <div class="movie-poster w-24 h-36 rounded-lg shadow-2xl overflow-hidden" style="background: linear-gradient(145deg, #8b5cf6, #6d28d9);">
      <div class="h-full flex flex-col items-center justify-center text-white/90 p-2">
       <svg class="w-10 h-10 mb-1" fill="currentColor" viewbox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" />
       </svg><span class="text-xs font-semibold text-center">Sci-Fi</span>
      </div>
     </div>
    </div>
    <div class="absolute bottom-20 right-16 md:right-32 animate-float-delay opacity-50 hidden md:block">
     <div class="movie-poster w-20 h-28 rounded-lg shadow-2xl overflow-hidden" style="background: linear-gradient(145deg, #ec4899, #be185d);">
      <div class="h-full flex flex-col items-center justify-center text-white/90 p-2">
       <svg class="w-8 h-8 mb-1" fill="currentColor" viewbox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
       </svg><span class="text-xs font-semibold text-center">Romance</span>
      </div>
     </div>
    </div>
    <!-- Main Content -->
    <div class="relative z-10 min-h-full flex flex-col items-center justify-center px-6 py-20">
     <!-- Logo/Icon -->
     <div class="mb-8 animate-slide-up" style="animation-delay: 0.1s;">
      <div class="w-20 h-20 rounded-2xl flex items-center justify-center shadow-2xl" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
       <svg class="w-12 h-12 text-white" fill="currentColor" viewbox="0 0 24 24">
        <path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4zM4 12V8h2v4H4zm14 6H6v-2h12v2zm0-4H6v-2h12v2zm2-4h-2V8h2v2z" />
       </svg>
      </div>
     </div>
     <!-- Title -->
     <h1 id="main-title" class="font-display text-5xl md:text-7xl lg:text-8xl text-center mb-4 animate-slide-up" style="color: #f5f5f5; animation-delay: 0.2s; letter-spacing: 0.05em;">DISCOVER YOUR NEXT<br><span style="color: #ef4444;">FAVORITE FILM</span></h1>
     <!-- Tagline -->
     <p id="tagline" class="text-lg md:text-xl text-center max-w-2xl mb-12 animate-slide-up" style="color: #9ca3af; animation-delay: 0.3s;">Personalized movie recommendations powered by your taste. From blockbusters to hidden gems, find your perfect watch tonight.</p>
     <!-- CTA Button --> <button id="get-recommendations-btn" class="group relative px-10 py-5 rounded-full font-semibold text-lg text-white transition-all duration-300 animate-slide-up animate-pulse-glow hover:scale-105" style="background: linear-gradient(135deg, #ef4444, #dc2626); animation-delay: 0.4s;"> <span id="button-text" class="relative z-10 flex items-center gap-3"> Get Recommendations 
       <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
       </svg></span> </button> 
       <!-- Stats -->
     <div class="mt-16 flex flex-wrap justify-center gap-8 md:gap-16 animate-fade-in" style="animation-delay: 0.6s;">
      <div class="text-center">
       <div class="font-display text-3xl md:text-4xl" style="color: #f5f5f5;">
        10K+
       </div>
       <div class="text-sm" style="color: #6b7280;">
        Movies
       </div>
      </div>
      <div class="text-center">
       <div class="font-display text-3xl md:text-4xl" style="color: #f5f5f5;">
        50+
       </div>
       <div class="text-sm" style="color: #6b7280;">
        Genres
       </div>
      </div>
      <div class="text-center">
       <div class="font-display text-3xl md:text-4xl" style="color: #f5f5f5;">
        98%
       </div>
       <div class="text-sm" style="color: #6b7280;">
        Match Rate
       </div>
      </div>
     </div>
    </div>
   </div><!-- RECOMMENDATION PAGE -->
   <div id="recommendation-page" class="hidden min-h-full w-full relative overflow-hidden" style="background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);">
    <div class="grain"></div><!-- Back Button --> <button id="back-btn" class="absolute top-6 left-6 z-20 flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 hover:scale-105" style="background: rgba(255,255,255,0.1); color: #f5f5f5; backdrop-filter: blur(10px);">
     <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
     </svg> Back </button> <!-- Search Section -->
    <!-- Search Section -->
<div class="relative z-10 pt-24 pb-12 flex justify-center">
  <div class="w-full max-w-2xl px-6">

    <div class="relative w-full">

      <input id="movie-search"
             type="text"
             placeholder="Search for a movie..."
             class="w-full px-6 py-4 rounded-full text-white placeholder-gray-400 focus:outline-none focus:ring-2 transition-all"
             style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px);">

      <button id="search-btn"
              class="absolute right-2 top-1/2 -translate-y-1/2 px-6 py-2 rounded-full font-medium transition-all duration-300 hover:scale-105"
              style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white;">
        Search
      </button>

      <div id="suggestions"
           class="absolute left-0 right-0 mt-2 rounded-2xl shadow-2xl max-h-72 overflow-y-auto z-50 hidden"
           style="background: rgba(31,41,55,0.95); backdrop-filter: blur(10px);">
      </div>

    </div>

  </div>
</div>
     <!-- Header -->
     <div class="text-center mb-12">
      <h2 class="font-display text-4xl md:text-5xl mb-3" style="color: #f5f5f5; letter-spacing: 0.05em;">YOUR <span style="color: #ef4444;">RECOMMENDATIONS</span></h2>
      <p style="color: #9ca3af;">Curated picks based on your preferences</p>
     </div><!-- Movie Grid -->
     <div id="movies-grid" class="max-w-6xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div><!-- Loading State -->
     <div id="loading-state" class="text-center py-12 hidden">
      <div class="inline-block">
       <div class="w-12 h-12 rounded-full border-4 border-gray-600 border-t-red-500 animate-spin"></div>
      </div>
      <p class="mt-4" style="color: #9ca3af;">Finding recommendations...</p>
     </div><!-- Empty State -->
     <div id="empty-state" class="text-center py-20 hidden">
      <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
      </svg>
      <p class="text-lg font-medium" style="color: #f5f5f5;">No movies found</p>
      <p style="color: #9ca3af;">Try searching for a different movie</p>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      main_title: "DISCOVER YOUR NEXT<br><span style='color: #ef4444;'>FAVORITE FILM</span>",
      tagline: "Personalized movie recommendations powered by your taste. From blockbusters to hidden gems, find your perfect watch tonight.",
      button_text: "Get Recommendations",
      search_placeholder: "Search for a movie...",
      background_color: "#0f0f1a",
      primary_color: "#ef4444",
      text_color: "#f5f5f5",
      secondary_text_color: "#9ca3af",
      font_family: "Inter",
      font_size: 16
    };

    // State
    let allMovies = [];
    let currentRecommendations = [];

    // Page navigation
    const homePage = document.getElementById('home-page');
    const recommendationPage = document.getElementById('recommendation-page');
    const getRecommendationsBtn = document.getElementById('get-recommendations-btn');
    const backBtn = document.getElementById('back-btn');
    const movieSearch = document.getElementById('movie-search');
    const searchBtn = document.getElementById('search-btn');
    const suggestionsBox = document.getElementById('suggestions');
    const moviesGrid = document.getElementById('movies-grid');
    const loadingState = document.getElementById('loading-state');
    const emptyState = document.getElementById('empty-state');

    // Fetch all movies on load
    async function loadMovies() {
      try {
        const response = await fetch('/movies');
        allMovies = await response.json();
      } catch (error) {
        console.error('Error loading movies:', error);
      }
    }

    // Movie search with autocomplete
    movieSearch.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase().trim();
      
      if (!searchTerm) {
        suggestionsBox.classList.add('hidden');
        return;
      }

      const filtered = allMovies
        .filter(movie => movie.toLowerCase().includes(searchTerm))
        .slice(0, 8);

      if (filtered.length === 0) {
        suggestionsBox.classList.add('hidden');
        return;
      }

      suggestionsBox.innerHTML = filtered
        .map(movie => `
          <div class="px-6 py-3 cursor-pointer hover:bg-white/10 transition-colors border-b border-white/10 last:border-b-0" 
               onclick="selectMovie('${movie.replace(/'/g, "\\'")}')">
            <p style="color: #f5f5f5;">${movie}</p>
          </div>
        `)
        .join('');
      
      suggestionsBox.classList.remove('hidden');
    });

    // Select movie from suggestions
    function selectMovie(movieTitle) {
      movieSearch.value = movieTitle;
      suggestionsBox.classList.add('hidden');
      searchForRecommendations();
    }

    // Search for recommendations
    searchBtn.addEventListener('click', searchForRecommendations);
    movieSearch.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchForRecommendations();
    });

    async function searchForRecommendations() {
      const movieTitle = movieSearch.value.trim();
      
      if (!movieTitle) {
        alert('Please enter a movie title');
        return;
      }

      loadingState.classList.remove('hidden');
      emptyState.classList.add('hidden');
      moviesGrid.innerHTML = '';

      try {
        const response = await fetch('/recommend', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title: movieTitle })
        });

        const recommendations = await response.json();

        if (recommendations.length === 0) {
          loadingState.classList.add('hidden');
          emptyState.classList.remove('hidden');
          return;
        }

        currentRecommendations = recommendations;
        renderMovies(recommendations);
        loadingState.classList.add('hidden');
      } catch (error) {
        console.error('Error fetching recommendations:', error);
        loadingState.classList.add('hidden');
        emptyState.classList.remove('hidden');
      }
    }

    // Render movies grid
    function renderMovies(movies) {
      moviesGrid.innerHTML = movies
        .map((movie, index) => `
          <div class="movie-poster group rounded-2xl overflow-hidden cursor-pointer" style="background: linear-gradient(145deg, #1f2937, #111827); animation: slide-up 0.6s ease-out forwards; animation-delay: ${index * 0.1}s; opacity: 0;">
            <div class="aspect-[2/3] relative overflow-hidden">
              <img src="${movie.poster}" 
                   alt="${movie.title}" 
                   class="w-full h-full object-cover" 
                   loading="lazy"
                   onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 300 450%22%3E%3Crect fill=%22%23991b1b%22 width=%22300%22 height=%22450%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2218%22 fill=%22white%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22%3EMovie Poster%3C/text%3E%3C/svg%3E'">
              <div class="absolute bottom-0 inset-x-0 p-4" style="background: linear-gradient(transparent, rgba(0,0,0,0.9));">
                <div class="text-xs mb-1" style="color: #ef4444;">
                  Recommended
                </div>
              </div>
            </div>
            <div class="p-4">
              <h3 class="font-semibold text-lg mb-1 line-clamp-2" style="color: #f5f5f5;">${movie.title}</h3>
              <p class="text-sm" style="color: #9ca3af;">Start watching now â†’</p>
            </div>
          </div>
        `)
        .join('');
    }

    // Page navigation
    getRecommendationsBtn.addEventListener('click', () => {
      homePage.classList.add('hidden');
      recommendationPage.classList.remove('hidden');
      movieSearch.focus();
    });

    backBtn.addEventListener('click', () => {
      recommendationPage.classList.add('hidden');
      homePage.classList.remove('hidden');
      movieSearch.value = '';
      suggestionsBox.classList.add('hidden');
    });

    // Initialize
    loadMovies();

    // Element SDK initialization
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          const mainTitle = document.getElementById('main-title');
          const tagline = document.getElementById('tagline');
          const buttonText = document.getElementById('button-text');
          
          mainTitle.innerHTML = config.main_title || defaultConfig.main_title;
          tagline.textContent = config.tagline || defaultConfig.tagline;
          
          const btnTextContent = config.button_text || defaultConfig.button_text;
          buttonText.innerHTML = `${btnTextContent} <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>`;
          
          // Apply colors
          const primaryColor = config.primary_color || defaultConfig.primary_color;
          const textColor = config.text_color || defaultConfig.text_color;
          const bgColor = config.background_color || defaultConfig.background_color;
          const secondaryTextColor = config.secondary_text_color || defaultConfig.secondary_text_color;
          
          document.querySelectorAll('[style*="color: #ef4444"]').forEach(el => {
            el.style.color = primaryColor;
          });
          
          mainTitle.style.color = textColor;
          tagline.style.color = secondaryTextColor;
          
          // Apply font
          const fontFamily = config.font_family || defaultConfig.font_family;
          const baseFontStack = 'Inter, sans-serif';
          document.body.style.fontFamily = `${fontFamily}, ${baseFontStack}`;
          
          // Apply font size
          const baseSize = config.font_size || defaultConfig.font_size;
          tagline.style.fontSize = `${baseSize * 1.125}px`;
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => { config.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
            },
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => { config.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); }
            },
            {
              get: () => config.secondary_text_color || defaultConfig.secondary_text_color,
              set: (value) => { config.secondary_text_color = value; window.elementSdk.setConfig({ secondary_text_color: value }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => { config.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => { config.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["main_title", config.main_title || defaultConfig.main_title],
          ["tagline", config.tagline || defaultConfig.tagline],
          ["button_text", config.button_text || defaultConfig.button_text]
        ])
      });
    }
  </script>
</body>
</html>